apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'
apply plugin: 'kotlin-android-extensions'
apply plugin: 'com.google.protobuf'
apply plugin: 'kotlin-kapt'

android {
    compileSdkVersion 29
    buildToolsVersion '29.0.3'
    defaultConfig {
        applicationId "me.taosunkist.hello"
        minSdkVersion 21
        multiDexEnabled true
        targetSdkVersion 29
        versionCode 1
        versionName "1.0"
        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }
    dataBinding {
        enabled true
    }
    sourceSets {
        main {
//            proto {
//                // In addition to the default 'src/main/proto'
//                srcDir 'src/main/protobuf'
//                // In addition to the default '**/*.proto' (use with caution).
//                // Using an extension other than 'proto' is NOT recommended,
//                // because when proto files are published along with class files, we can
//                // only tell the type of a file from its extension.
//                include '**/*.protodevel'
//            }
            java {
                main.java.srcDirs += 'src/main/kotlin'
                main.java.srcDirs += 'src/main/java'

                main.java.srcDirs += 'src/test/java'
                main.java.srcDirs += 'src/test/kotlin'
            }
        }
    }
    configurations {
        all*.exclude group: 'com.google.guava', module: 'listenablefuture'
    }
}
allprojects {
    repositories {
        maven { url 'https://jitpack.io' }
        flatDir {
            dirs 'libs'
        }
    }
}

protobuf {
    protoc { artifact = 'com.google.protobuf:protoc:3.6.1' }
    protoc { path = '/Users/taohui/DevStation/opt/protobuf/protoc-3.11.4-osx-x86_64/bin/protoc' }
    plugins {
        javalite { artifact = "com.google.protobuf:protoc-gen-javalite:3.0.0" }
        grpc { artifact = 'io.grpc:protoc-gen-grpc-java:1.19.0' }
    }

    generateProtoTasks {
        all().each { task ->
            task.plugins {
                javalite {}
                grpc { // Options added to --grpc_out
                    option 'lite'
                }
            }
        }
    }
}
dependencies {
    implementation fileTree(include: ['*.jar'], dir: 'libs')
    /* 素材依赖 */
    implementation project(path: ':materials')

    implementation junit
    implementation kotlinStdlibJdk7
    implementation kotlinReflect

    implementation flycoTabLayout_lib

    implementation grpcOkhttp
    implementation grpcProtobufLite
    implementation grpcStub

    implementation javaxAnnotationApi
    implementation appcompat
    implementation viewpager
    implementation recyclerview
    implementation constraintLayout
    implementation material
    implementation multidex
    implementation rxandroid
    implementation rxkotlin
    implementation rxrelay
    implementation legacySupportV4
    implementation singledateandtimepicker
    implementation constraintlayout
    implementation cardview
    implementation design
    implementation lifecycleExtensions
    implementation lifecycleViewmodelKtx
    implementation converterGson
    implementation androidwmLight

    /* Image Loading/Processing */
    implementation picasso
    implementation legacySupport
    implementation fakeit
}

repositories {
    mavenCentral()
    flatDir {
        dirs 'libs'
    }
}
configurations.all {
    resolutionStrategy.force 'com.google.code.findbugs:jsr305:3.0.1'
}
android {
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
}
